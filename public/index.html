<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Human Expert Validation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,600&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="app-shell">
      <aside class="sidebar">
        <h1 class="brand">Human Expert Validation</h1>
        <section class="auth-card">
          <div id="current-user" class="current-user">Not signed in</div>
          <button id="logout-btn" class="secondary hidden">Log out</button>
        </section>
        <section id="admin-panel" class="admin-panel hidden">
          <h2>Admin</h2>
          <details class="admin-details" open>
            <summary>Upload Validation Files</summary>
            <p class="small muted">
              Workflow: upload your CSV files first. Items = rows. Studies = unique PMIDs.
            </p>
            <div class="upload-grid">
              <label class="file-field">
                Extraction CSV
                <span class="small muted">expected: extracted_insights.csv</span>
                <input id="upload-extracted" type="file" accept=".csv,text/csv" />
              </label>
              <label class="file-field">
                Q&amp;A CSV
                <span class="small muted">expected: qa_pairs.csv</span>
                <input id="upload-qa" type="file" accept=".csv,text/csv" />
              </label>
            </div>
            <div class="admin-actions">
              <button id="upload-btn" class="primary">Upload</button>
              <button id="reload-data-btn" class="secondary">Reload</button>
            </div>
            <div id="data-status" class="data-status"></div>
          </details>
          <details class="admin-details">
            <summary>Manage Users</summary>
            <p class="small muted">Create expert accounts so each reviewer can pause and resume their own work.</p>
            <div class="user-form">
              <label>
                Username
                <input id="new-username" type="text" autocomplete="off" placeholder="expert1" />
              </label>
              <label>
                Display name
                <input id="new-displayname" type="text" autocomplete="off" placeholder="Dr. Expert" />
              </label>
              <label>
                Password
                <input id="new-password" type="password" autocomplete="new-password" placeholder="min 8 chars" />
              </label>
              <label>
                Role
                <select id="new-role">
                  <option value="expert" selected>Expert</option>
                  <option value="admin">Admin</option>
                </select>
              </label>
              <button id="create-user-btn" class="primary">Create User</button>
            </div>
            <div id="user-list" class="user-list"></div>
          </details>
        </section>
        <section class="dataset-section">
          <h2>Dataset</h2>
          <div id="dataset-list"></div>
        </section>
        <section class="controls">
          <button id="summary-btn" class="secondary">View Summary</button>
          <div class="toggle-row">
            <label class="toggle">
              <input id="unreviewed-toggle" type="checkbox" />
              <span>Show unreviewed only</span>
            </label>
          </div>
          <div class="search">
            <input id="search-input" type="search" placeholder="Search..." />
          </div>
          <div class="download-cta">
            <button id="download-csv" class="cta">Download results (CSV)</button>
            <button id="download-json" class="cta ghost">Download results (JSON)</button>
          </div>
          <div class="pagination">
            <button id="prev-page" class="secondary">◀ Prev</button>
            <span id="page-info"></span>
            <button id="next-page" class="secondary">Next ▶</button>
          </div>
        </section>
        <section class="stats" id="stats"></section>
        <section class="progress" id="progress"></section>
      </aside>
      <main class="content">
        <header class="content-header">
          <h2 id="dataset-title">Items</h2>
          <p class="hint">Upload files (admin) then experts review items. Every click is saved immediately so reviewers can pause and resume later.</p>
        </header>
        <section id="items" class="item-list"></section>
      </main>
    </div>

    <div id="modal" class="modal hidden">
      <div class="modal-card">
        <h3 id="modal-question"></h3>
        <p id="modal-subtext"></p>
        <div class="modal-actions">
          <button id="modal-confirm" class="primary">Yes, confident</button>
          <button id="modal-cancel" class="secondary">No, unsure</button>
          <button id="modal-abort" class="ghost">Cancel</button>
        </div>
      </div>
    </div>

    <div id="compare-modal" class="modal hidden">
      <div class="modal-card large">
        <h3>Select the strongest QA pair for this abstract</h3>
        <div id="compare-list"></div>
        <div class="modal-actions">
          <button id="compare-submit" class="primary">Save Choice</button>
          <button id="compare-close" class="secondary">Close</button>
        </div>
      </div>
    </div>

    <div id="summary-modal" class="modal hidden">
      <div class="modal-card large">
        <h3>Session Summary</h3>
        <div id="summary-content"></div>
        <div class="modal-actions space-between">
          <div class="export-group" id="export-buttons"></div>
          <button id="summary-close" class="secondary">Close</button>
        </div>
      </div>
    </div>

    <div id="login-modal" class="modal hidden">
      <div class="modal-card login-card">
        <h3>Expert Login</h3>
        <p>Sign in to review data and submit judgements.</p>
        <form id="login-form" class="login-form">
          <label>
            Username
            <input id="login-username" type="text" autocomplete="username" required />
          </label>
          <label>
            Password
            <input id="login-password" type="password" autocomplete="current-password" required />
          </label>
          <p id="login-error" class="login-error hidden"></p>
          <div class="modal-actions">
            <button type="submit" class="primary">Sign in</button>
          </div>
        </form>
      </div>
    </div>

    <div id="toast" class="toast hidden"></div>

    <script src="app.js" type="module"></script>
  </body>
</html>
